# システム概要

> 今回考えるシステムの概要についての説明を行う.

## 最終機能概要

研究用グループウェアシステム(LabGroupware)を今回の研究対象とし, 以下にその機能を示す.

### Member管理
- ログイン可能なメンバーが存在する.
- 登録方法としては, 以下のパターンがある.
  - メンバー作成オーソリティを保持したメンバーによる作成.
  - 管理者用Webや管理者用CLIから作成する.
### Role管理
- オーソリティという概念がある.
  - あるエンティティに関するグローバルなアクション権限(MemberUpdateGroup, ManageRoleAttachedMember, ManageAuthorityAttachedRoleなど).
- ロールには, オーソリティを複数アタッチする.
- メンバーは, ロールを最大1つまでアタッチ可能であり, 付与されたロールにアタッチされた権限を所有することとなる.
- 1ロールを複数メンバーにアタッチすることは可能.
### Group管理
- 権限のあるメンバーが作成することができ, 以下で説明するグループ単位での権限であるpermissionによって, グループ情報の変更や削除, メンバーの追加, 削除などが可能.
- グループの中には, サブグループの作成が可能であり, サブグループも通常グループと同様に扱われ, 同様のリソースを保持するが, 以下のような事項が異なる.
  - 親グループのメンバーのみ所属可能.
  - 親グループでのPermissionにより, グループの作成が可能.
  - 親グループが削除されたり, 親グループを抜けた際は, 子グループも自動的に削除, 脱退することとなる.
- タグ機能が存在しており, グループのメンバーにタグをつけることで他リソースからの参照時に識別することができる.
- 以下の特殊なグループが存在しており, 通常の操作ではグループへの加入や脱退が不可能である.またこれらに関する権限は管理者用Webもしくは管理者用CLIからも操作可能で, サブグループの作成も認められない.
  - 全体グループ
    - 全体グループがデフォルトで存在しており, メンバーは作成された段階で必ずここに所属することになる.
### WorkPosition管理
- グループ内のオーソリティに該当するのがPermission, ロールに該当するのがWorkPositionである.
- ロール管理とほとんど同様ではあるが, WorkPosition自体, グループに紐付いているため, あるグループで作成したWorkPositionを別グループのWorkPositionとしてメンバーにマッピングすることはできない.
### Chanel管理
- グループ内にChanelを複数作成可能であり, グループ作成時にはグループ名と同名のチャネル(Default)が作成されている.
- Chanelには, 投稿することが可能で, その投稿にはスレッドができる.
- スレッド内でコメントなどを投稿することが可能.
- また, StorageやChat, Event, Plan, Bookなどに関するグループに紐づくリソースはアクションごとに, そのグループ内の指定チャネルへの投稿を同時に行うことも可能である.
### Storage管理
- 単なるアップロード, ダウンロード, 削除を行う他に, メタ情報も保持しており, 他リソースとのリレーションも行いやすいようにID管理を行っている.
- メンバー, またはグループには1つのストレージが与えられており, ストレージにはバケットを作成することができる(グループの場合は権限が必要).
- バケットはファイルシステムになっており, その中に対して自由にディレクトリやファイルの作成が可能.
- ストレージには, Defaultバケットが存在し, その中には, 以下のディレクトリが用意されている.
  - /Profile: 個人メンバーやグループのプロフィール画像が保存される.
  - /Chanel/{Chanel_name}: チャネル内のファイルや画像などが保存される.
  - /Chat: チャットトーク内のファイルや画像などが保存される.
  - /Event: イベントに添付されるファイルや画像などが保存される.
  - /Plan: タスクに添付されるファイルや画像などが保存される.
  - /Book: ブックに添付されるファイルや画像などが保存される.
### Chat管理
- 自由にチャットルームを作成して, メンバーを追加することでリアルタイムチャットを実現できる.
- 個人に対するチャットも可能.
- グループ作成時に自動でそれに紐づくチャットルームが作られるが, そのチャットルームに対しては, 直接チャットルームの削除やメンバーの追加などの操作は不可能であり, グループから変更する必要がある.
- ストレージ管理サービスに対するアップロードで返却されたIDを利用して, 画像やファイルの送信が可能.
### Event管理
- 15分単位の設定が可能.
- イベントの管理が可能で, 何日の何時から何日の何時まであるかを登録可能で重複も認められる.
- メンバーもしくはグループ(permissionが必要)単位での作成が可能であり, メンバー単位の場合はそのメンバー, グループ単位の場合は編集, 削除などの権限があるグループ内メンバーが修正, 削除を行うことができる.
- 登録時のメール送信をオプションで設定可能であり, メンバーを複数選択もしくはグループ全員, サブグループ単位, タグ単位での指定が可能で送信したことは保持しておく必要がある.
- イベントの更新時にはメールを一度送信済みの場合, メールを再送信することをオプションで可能にできる.
- イベントの開始15分, 30分, 60分, 3時間, 1日, 3日前のメール通知を有効化することもできる.
- ストレージ管理サービスに対するアップロードで返却されたIDを利用して, 画像やファイルが複数添付可能.
- イベントに対して, 一つのコメントスレッドが作成されているので, やり取りが可能.
### Plan管理
- Planという最も大きな単位の中に複数のバケットを作成することが可能.
- バケットの中にはタスクをいくつも定義可能.
- Planはメンバー個人もしくはグループ単位で作成可能で, メンバー個人もしくはグループは複数のPlanを保持できる(ただし, グループでの作成の場合Permissionが必要).
- タスクの進行状況ステータス, ラベルは, Planごとに自作する.
- タスクの登録項目としては, 少なくとも以下のような項目がある.
  - タイトル
  - 詳細
  - 担当者(メンバーを複数選択もしくはグループ全員, サブグループ単位, タグ単位)
  - 開始日時
  - 期限日時
  - 複数の添付ファイルや画像
  - 複数ラベル
  - 進行状況ステータス
  - チェックリスト
  - 通知設定(何日前にどのステータスならば担当者へ通知するのか)
- タスクに対して, 一つのコメントスレッドが作成されているので, やり取りが可能.
### Book管理
- Bookという最も大きな単位の中に階層構造のPageを作成できるが, ディレクトリとファイルといった形式ではなく, トップのPageに対して, 複数の子Pageが存在して, さらにそのPageに子Pageが存在するといった形式である.
- Bookはメンバー個人もしくはグループ単位で作成可能で, メンバー個人もしくはグループは複数のBookを保持できる(ただし, グループでの作成の場合Permissionが必要).
- Bookごとに公開設定の変更が可能.
  - 所有メンバー内もしくは所有グループ内のみ
  - 全メンバー
- Bookは(グループであればPermissionさえあれば), 作成, 削除, 編集が可能で, Pageの追加, 削除, 編集も自由に行うことができる.
- Bookごとに以下のイベント履歴が担当メンバーとタイムスタンプと共に残ることになる.
  - Bookの作成
  - Bookの情報更新
  - Pageの追加
  - Pageの削除
  - Pageの編集
- 全文検索が可能.

## 第一段階での機能
- Member管理
- Role管理
- Group管理
- WorkPosition管理
- Channel管理
- Storage管理
- Chat管理

## フロントインタフェース

また, フロントエンドのインタフェースとしては, Web, 管理者用Web, 管理者用CLIがあり, 管理者用CLIからは`gRPC`での通信, それ以外からは`REST API`となっているが, 今後さらにNativeApp(iPhone, Android)やDesktopApp(Windows, Mac, Linux)の他にWebHook, PublicAPIの提供も考えている.


## 後の実装予定
- RateLimit
- Cache
- Chanel管理における以下の機能
  - リアクション
  - リプライ
  - メンション
  - 転送
  - 全文検索
- Chat管理における以下の機能
  - メンション
  - リプライ
  - 転送
  - リアクション
  - 全文検索
- Event管理における以下の機能
  - 繰り返し
- Plan管理における以下の機能
  - 繰り返し
- Storage管理における以下の機能
  - バケットごとに任意でメタデータの追加とそれによるフィルタリング